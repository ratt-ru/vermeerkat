---
general:
    solr-url: "http://192.168.1.50:8983/solr/kat_core"
    msdir : 'msdir'
    input : 'input'
    output : 'output'
    fov : 3.5
    padding : 1.15
    sampling : 0.95 # PSF sampling (<1)
    prefix : 'vermeerkat-pipeline' # change me, please!
    gcal_selection_heuristic : 'most_scans'
    bw_per_mfs_slice : 200.0e6 # MHz
    max_baseline : 4.3e3
    imaging_pol : "I"

###############################################################
## Convert
###############################################################

h5toms:
    full_pol: false
    pols-to-use: "HH,VV"

rfimask:
    rfi-mask-file: "rfi_mask.pickle"

autoflag:
    column: "DATA"
    strategy-file: "29Dec2016_firstpass_strategy.rfis"

casa_fixvis:
  reuse: false

###############################################################
## RFI and band Flagging
###############################################################

flag_userflags:
     mode: "manual"
     field: null
     antenna: null
     scan: null
     timerange: null
     spw: null
     autocorr: false

flag_bandstart:
    mode: "manual"
    field: ""
    spw: "0:0~110"
    autocorr: false

flag_bandend:
    mode: "manual"
    field: ""
    spw: "0:3840~4095"
    autocorr: false

flag_autocorrs:
    mode: "manual"
    field: ""
    spw: "0:0~4095"
    autocorr: true # flag only the autocorrs

###############################################################
## 1GC calibration
###############################################################

setjy_manual:
    standard: "manual"
    usescratch: false
    scalebychan: true
    spw: ""

setjy_auto:
    standard: "Perley-Butler 2010"

phase0:
    caltable: ""
    field: ""
    refant: ""
    calmode: "p"
    solint: ""
    solnorm: true
    minsnr: 3.0

bandpass:
    caltable: ""
    field: ""
    spw: ""
    refant: ""
    combine: "scan"
    solint: ""
    solnorm: true
    bandtype: "B"
    minblperant: 1
    minsnr: 3.0
    gaintable: []
    interp: ["nearest", "nearest"]

delaycal:
    field: ""
    gaintype: "K"
    solint: inf # not sure if this is optimal
    minsnr: 5.0
    refant: 0
    caltable: ""
    calmode: "p"

gaincal:
    caltable: ""
    field:   ""
    spw: ""
    solint:  ""
    refant: ""
    gaintype: "G"
    calmode: "ap"
    solnorm:  false
    gaintable: []
    interp:   ["linear", "linear", "nearest"]

fluxscale:
    caltable: ""
    fluxtable: ""
    reference: ""
    transfer: ""
    incremental: false

applycal:
    field: ""
    gaintable: []
    gainfield: []
    spwmap: [[], [], []]
    parang: false
    interp: ["linear", "linear", "nearest", "linear"]

###############################################################
## Post 1GC flagging
###############################################################

autoflag_corrected_vis:
    column: "CORRECTED_DATA"
    strategy-file: "06Jan2017_secondpass_strategy.rfis"

flag_phases_amplitudes:
    task: "flag_excessive_amp_phase_error"
    data_column: "CORRECTED_DATA"
    valid_phase_range: "-40.0~40.0"
    max_invalid_datapoints: 0.35 # 35% of all unflagged data per channel
    amp_frac_clip: 0.35
    nrows_chunk: 100000
    simulate: false
    nthreads: 16

###############################################################
## Diagnostic plots
###############################################################

plot_ampuvdist:
    xaxis: "uvdist"
    yaxis: "amplitude"
    xdatacolumn: "corrected"
    ydatacolumn: "corrected"
    field: ""
    iteraxis: "corr"
    avgchannel: "15"
    avgtime: "15"
    coloraxis: "channel"
    expformat: "png"
    exprange: "all"
    plotfile: ""

plot_phaseuvdist:
    xaxis: "uvdist"
    yaxis: "phase"
    xdatacolumn: "corrected"
    ydatacolumn: "corrected"
    field: ""
    iteraxis: "corr"
    avgchannel: "15"
    avgtime: "15"
    coloraxis: "channel"
    expformat: "png"
    exprange: "all"
    plotfile: ""

plot_phaseball:
    xaxis: "amplitude"
    yaxis: "phase"
    xdatacolumn: "corrected"
    ydatacolumn: "corrected"
    field: ""
    iteraxis: "corr"
    avgchannel: "15"
    avgtime: "15"
    coloraxis: "baseline"
    expformat: "png"
    exprange: "all"
    plotfile: ""

plot_amp_freq:
    xaxis: "frequency"
    yaxis: "amplitude"
    xdatacolumn: "corrected"
    ydatacolumn: "corrected"
    field: ""
    iteraxis: "corr"
    avgchannel: "0"
    avgtime: "0"
    coloraxis: "baseline"
    expformat: "png"
    exprange: "all"
    plotfile: ""

plot_phase_time:
    xaxis: "time"
    yaxis: "phase"
    xdatacolumn: "corrected"
    ydatacolumn: "corrected"
    field: ""
    iteraxis: "corr"
    avgchannel: "0"
    avgtime: "0"
    coloraxis: "baseline"
    expformat: "png"
    exprange: "all"
    plotfile: ""

plot_phase_freq:
    xaxis: "frequency"
    yaxis: "phase"
    xdatacolumn: "corrected"
    ydatacolumn: "corrected"
    field: ""
    iteraxis: "corr"
    avgchannel: "0"
    avgtime: "0"
    coloraxis: "baseline"
    expformat: "png"
    exprange: "all"
    plotfile: ""

wsclean_bandpass:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0
    cellsize: 0
    clean_iterations: 10000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    field: ""
    name: ""

wsclean_gain:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0
    cellsize: 0
    clean_iterations: 10000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    field: ""
    name: ""

###############################################################
## 1GC image
###############################################################

wsclean_image_1gc_0:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 10

cleanmask_1gc_0:
  sigma: 9
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_1gc_1:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 8

cleanmask_1gc_1:
  sigma: 7
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_1gc_2:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 4

cleanmask_1gc_2:
  sigma: 6
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_1gc_3:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 2

###############################################################
## CASA Phase only selfcal
###############################################################

move_corrdata_to_data_casa:
    command: "copycol"
    fromcol: "CORRECTED_DATA"
    tocol: "DATA"

casa_sc0_gaincal:
    spw: ""
    gaintype: "G"
    calmode: "p"
    solnorm:  false
    combine: "scan"
    solint: "45s"
    minsnr: 2.0

casa_sc0_applycal:
    field: ""
    spwmap: [[], [], []]
    parang: false
    interp: ["linear"]

casa_sc0_gainamp_time:
    xaxis: "time"
    yaxis: "gainamp"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

casa_sc0_gainphase_time:
    xaxis: "time"
    yaxis: "gainphase"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

casa_sc0_gainamp_freq:
    xaxis: "freq"
    yaxis: "gainamp"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

casa_sc0_gainphase_freq:
    xaxis: "freq"
    yaxis: "gainphase"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

###############################################################
## MT Phase only selfcal
###############################################################

move_corrdata_to_data:
    command: "copycol"
    fromcol: "CORRECTED_DATA"
    tocol: "DATA"

source_find0:
    pybdsm: true
    thresh_pix: 20
    thresh_isl: 10

specfit0:
  make_spi: true # Make SPI map
  tol: [-4, 4]   # Anything above this spi is highly unlikely
  spi_image: ""  # Don't have an alpha map
  add_spi: true
  skymodel: ""
  freq0: 0
  sigma: 20

selfcal0:
  reset: "all" # Reset all existing gains
  label: "cal0"
  ncpu: 16
  column: "DATA"
  output: "CORR_DATA"
  gjones: true
  gjones_time_interval: 15
  gjones_freq_interval: 90
  ddjones_smoothing: 1
  ejones: false
  beam_files_pattern: ""
  beam_l_axis: ""
  beam_m_axis: ""
  gjones_ampl_clipping: true
  gjones_ampl_clipping_low: 0.15
  gjones_ampl_clipping_high: 3.0
  gjones_matrix_type: "GainDiagPhase"
  gjones_thresh_sigma:  11
  gjones_chisq_clipping : true
  tile_size : 128

###############################################################
## Phase-only selfcal image
###############################################################

wsclean_image_sc0_0:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 10

cleanmask_sc0_0:
  sigma: 9
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_sc0_1:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 7

cleanmask_sc0_1:
  sigma: 7
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_sc0_2:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 4

cleanmask_sc0_2:
  sigma: 6
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_sc0_3:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 1.5

###############################################################
## CASA Amplitude & Phase selfcal
###############################################################

casa_sc1_gaincal:
    spw: ""
    gaintype: "G"
    calmode: "ap"
    solnorm:  true
    combine: "scan"
    solint: "45s"
    minsnr: 2.0

casa_sc1_applycal:
    field: ""
    spwmap: [[], [], []]
    parang: false
    interp: ["linear"]

casa_sc1_gainamp_time:
    xaxis: "time"
    yaxis: "gainamp"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

casa_sc1_gainphase_time:
    xaxis: "time"
    yaxis: "gainphase"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

casa_sc1_gainamp_freq:
    xaxis: "freq"
    yaxis: "gainamp"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

casa_sc1_gainphase_freq:
    xaxis: "freq"
    yaxis: "gainphase"
    iteraxis: "antenna"
    avgchannel: "5"
    avgtime: "5"
    coloraxis: "corr"
    expformat: "png"
    exprange: "all"

###############################################################
## MT Amplitude and Phase selfcal
###############################################################

source_find1:
    pybdsm: true
    thresh_pix: 20
    thresh_isl: 10

specfit1:
  make_spi: true # Make SPI map
  tol: [-4, 4]   # Anything above this spi is highly unlikely
  spi_image: ""  # Don't have an alpha map
  add_spi: true
  skymodel: ""
  freq0: 0
  sigma: 20

selfcal1:
  reset: "all" # Reset all existing gains
  label: "cal1"
  ncpu: 16
  column: "DATA"
  output: "CORR_RES"
  gjones: true
  gjones_time_interval: 15
  gjones_freq_interval: 90
  ddjones_smoothing: 1
  ejones: false
  beam_files_pattern: ""
  beam_l_axis: ""
  beam_m_axis: ""
  gjones_ampl_clipping: true
  gjones_ampl_clipping_low: 0.15
  gjones_ampl_clipping_high: 3.0
  gjones_matrix_type: "Gain2x2"
  gjones_thresh_sigma:  11
  gjones_chisq_clipping : true
  tile_size : 128

###############################################################
## Phase amplitude selfcal image
###############################################################

wsclean_image_sc1_0:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 10

cleanmask_sc1_0:
  sigma: 9
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_sc1_1:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 6

cleanmask_sc1_1:
  sigma: 7
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_sc1_2:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 2

cleanmask_sc1_2:
  sigma: 6
  iters: 30
  kernel: 15
  no_negative: false
  tolerance: 0.01
  overlap: 0.3

wsclean_image_sc1_3:
    column: "CORRECTED_DATA"
    weight: "briggs"
    robust: -2
    npix: 0.0
    cellsize: 0.0
    clean_iterations: 100000
    mgain: 0.9
    channelsout: 0
    joinchannels: true
    taper_gaussian: 44asec
    autothreshold     : 0.5

wsclean_v_residue:
    "column"            : 'CORRECTED_DATA'
    "weight"            : 'briggs'
    "robust"            : 0
    "npix"              : 0
    "cellsize"          : 0
    "clean_iterations"  : 10000
    "mgain"             : 0.9
    "channelsout"       : 0
    "joinchannels"      : true
    "field"             : ""
    "pol"               : "V"
